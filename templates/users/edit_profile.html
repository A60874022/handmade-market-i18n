{% extends 'base.html' %}
{% load static %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è | HandmadeMarket{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="text-center mb-5">
                <h1 class="fw-bold mb-3">üë§ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h1>
                <p class="text-muted">–û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –º–∞—Å—Ç–µ—Ä–∞</p>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
            <ul class="nav nav-tabs nav-justified mb-4" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="main-tab" data-bs-toggle="tab" data-bs-target="#main"
                        type="button" role="tab" aria-controls="main" aria-selected="true">
                        üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="goods-tab" data-bs-toggle="tab" data-bs-target="#goods" type="button"
                        role="tab" aria-controls="goods" aria-selected="false">
                        üõçÔ∏è –ú–æ–∏ —Ç–æ–≤–∞—Ä—ã
                    </button>
                </li>
            </ul>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
            <div class="tab-content" id="profileTabsContent">

                <!-- –í–∫–ª–∞–¥–∫–∞ "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" -->
                <div class="tab-pane fade show active" id="main" role="tabpanel" aria-labelledby="main-tab">

                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                    {% if messages %}
                    {% for message in messages %}
                    {% if forloop.first %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4" role="alert">
                        {% if message.tags == 'success' %}‚úÖ{% elif message.tags == 'error' %}‚ùå{% else %}‚ÑπÔ∏è{% endif %}
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}

                    <div class="card shadow-sm border-0">
                        <div class="card-body p-4">
                            <form method="post" enctype="multipart/form-data" id="profile-form">
                                {% csrf_token %}

                                <div class="row">
                                    <!-- –ê–≤–∞—Ç–∞—Ä –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                    <div class="col-lg-4 mb-4">
                                        <div class="text-center">
                                            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ -->
                                            <div class="position-relative d-inline-block">
                                                {% if user.profile.avatar and user.profile.avatar.url %}
                                                <img src="{{ user.profile.avatar.url }}" class="rounded-circle mb-3"
                                                    alt="–ê–≤–∞—Ç–∞—Ä {{ user.email }}"
                                                    style="width: 150px; height: 150px; object-fit: cover;"
                                                    id="avatar-preview">
                                                {% else %}
                                                <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-3 mx-auto"
                                                    style="width: 150px; height: 150px;" id="default-avatar">
                                                    <span class="text-white" style="font-size: 3rem;">üë§</span>
                                                </div>
                                                {% endif %}
                                            </div>

                                            <h5 class="fw-bold">{{ user.email }}</h5>
                                            {% if user.profile.city %}
                                            <p class="text-muted mb-3">üìç {{ user.profile.city.name }}</p>
                                            {% else %}
                                            <p class="text-muted mb-3">üìç –ì–æ—Ä–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω</p>
                                            {% endif %}

                                            <!-- –ë–µ–π–¥–∂ –º–∞—Å—Ç–µ—Ä–∞ -->
                                            <div class="mb-3">
                                                <span class="badge bg-success fs-6">üé® –ú–∞—Å—Ç–µ—Ä</span>
                                            </div>

                                            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">
                                                    üì∑ –ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                                                </label>
                                                <div class="avatar-upload-container">
                                                    {% if user.profile.avatar and user.profile.avatar.url %}
                                                    <!-- –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ -->
                                                    <div class="existing-avatar">
                                                        <div class="d-flex flex-column align-items-center gap-2 mb-2"
                                                            id="avatar-buttons">
                                                            <button type="button"
                                                                class="btn btn-outline-primary btn-sm replace-avatar-btn">
                                                                üìÅ –ó–∞–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                                                            </button>
                                                            <button type="button"
                                                                class="btn btn-outline-danger btn-sm remove-avatar-btn">
                                                                ‚ùå –£–¥–∞–ª–∏—Ç—å
                                                            </button>
                                                        </div>
                                                        <div class="avatar-upload-field" style="display: none;">
                                                            {{ profile_form.avatar }}
                                                            <div class="form-text mt-2">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG,
                                                                PNG, GIF, WebP, –º–∞–∫—Å. 5MB)</div>
                                                        </div>
                                                        <input type="hidden" name="avatar-clear" id="avatar-clear"
                                                            value="false">
                                                    </div>
                                                    {% else %}
                                                    <!-- –î–ª—è –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ -->
                                                    <div class="new-avatar">
                                                        {{ profile_form.avatar }}
                                                        <div class="form-text mt-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG,
                                                            GIF, WebP, –º–∞–∫—Å. 5MB)</div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                {% if profile_form.avatar.errors %}
                                                <div class="text-danger small mt-1">
                                                    {{ profile_form.avatar.errors.0 }}
                                                </div>
                                                {% endif %}
                                                <div class="form-text">
                                                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 150x150 px. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF, WebP
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã -->
                                    <div class="col-lg-8">
                                        <div class="row">
                                            <!-- Email -->
                                            <div class="col-12 mb-3">
                                                <label for="{{ user_form.email.id_for_label }}"
                                                    class="form-label fw-bold">
                                                    üìß Email –∞–¥—Ä–µ—Å
                                                </label>
                                                {{ user_form.email }}
                                                {% if user_form.email.errors %}
                                                <div class="text-danger small mt-1">
                                                    {{ user_form.email.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>

                                            <!-- –ì–æ—Ä–æ–¥ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º -->
                                            <div class="col-12 mb-3">
                                                <label for="{{ profile_form.city_search.id_for_label }}"
                                                    class="form-label fw-bold">
                                                    üèôÔ∏è –ì–æ—Ä–æ–¥
                                                </label>
                                                {{ profile_form.city_search }}
                                                <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –≥–æ—Ä–æ–¥–∞ -->
                                                {{ profile_form.city }}
                                                <!-- Datalist –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
                                                <datalist id="cities-datalist">
                                                    {% for city in cities %}
                                                    <option value="{{ city.name }}">{{ city.name }}</option>
                                                    {% endfor %}
                                                </datalist>
                                                {% if profile_form.city_search.errors %}
                                                <div class="text-danger small mt-1">
                                                    {{ profile_form.city_search.errors.0 }}
                                                </div>
                                                {% endif %}
                                                <div class="form-text">
                                                    –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞
                                                </div>
                                            </div>

                                            <!-- –û —Å–µ–±–µ -->
                                            <div class="col-12 mb-4">
                                                <label for="{{ profile_form.bio.id_for_label }}"
                                                    class="form-label fw-bold">
                                                    üí¨ –û —Å–µ–±–µ
                                                </label>
                                                {{ profile_form.bio }}
                                                <div class="d-flex justify-content-between align-items-center mt-1">
                                                    <div class="form-text">
                                                        –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ, —Å–≤–æ–µ–º –æ–ø—ã—Ç–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ
                                                    </div>
                                                    <div class="form-text text-end">
                                                        <span id="bio-counter">500</span> —Å–∏–º–≤–æ–ª–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å
                                                    </div>
                                                </div>
                                                {% if profile_form.bio.errors %}
                                                <div class="text-danger small mt-1">
                                                    {{ profile_form.bio.errors.0 }}
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                                        <div class="d-flex gap-3 flex-wrap">
                                            <button type="submit" class="btn btn-primary btn-lg px-4">
                                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                            </button>
                                            <a href="{% url 'products:catalog' %}"
                                                class="btn btn-outline-secondary btn-lg px-4">
                                                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- –ë–ª–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ -->
                    <div class="card border-danger mt-4">
                        <div class="card-header bg-danger text-white">
                            <h6 class="mb-0">üóëÔ∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h6>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="fw-bold text-danger">–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h6>
                                    <p class="text-muted small mb-0">
                                        –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.
                                        –í—Å–µ –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.
                                    </p>
                                </div>
                                <div class="col-md-4 text-md-end">
                                    <a href="{% url 'users:delete_account' %}" class="btn btn-outline-danger">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ "–ú–æ–∏ —Ç–æ–≤–∞—Ä—ã" -->
                <div class="tab-pane fade" id="goods" role="tabpanel" aria-labelledby="goods-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-body p-4 text-center">
                            <div class="mb-4" style="font-size: 4rem;">üéÅ</div>
                            <h4 class="fw-bold mb-3">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h4>
                            <p class="text-muted mb-4">–î–æ–±–∞–≤–ª—è–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ handmade-—Ç–æ–≤–∞—Ä—ã</p>

                            <div class="d-flex justify-content-center gap-3 flex-wrap">
                                <a href="{% url 'products:my_products' %}" class="btn btn-primary btn-lg px-4">
                                    üõçÔ∏è –ú–æ–∏ —Ç–æ–≤–∞—Ä—ã
                                </a>
                                <a href="{% url 'products:product_add' %}" class="btn btn-outline-primary btn-lg px-4">
                                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .nav-tabs .nav-link {
        color: #6c757d;
        border: none;
        padding: 1rem 1.5rem;
        font-weight: 500;
    }

    .nav-tabs .nav-link.active {
        color: #8B4513;
        border-bottom: 3px solid #8B4513;
        background: transparent;
    }

    .nav-tabs .nav-link:hover {
        color: #8B4513;
        border-bottom: 3px solid #8B4513;
    }

    .btn-primary {
        background-color: #8B4513;
        border-color: #8B4513;
        border-radius: 10px;
        font-weight: 600;
    }

    .btn-primary:hover {
        background-color: #654321;
        border-color: #654321;
    }

    .form-control,
    .form-select {
        border-radius: 10px;
        padding: 0.75rem 1rem;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #8B4513;
        box-shadow: 0 0 0 0.2rem rgba(139, 69, 19, 0.25);
    }

    .card {
        border-radius: 15px;
        border: none;
    }

    .avatar-upload-container .btn-sm {
        font-size: 0.8rem;
        padding: 0.25rem 0.75rem;
    }

    .existing-avatar .btn {
        min-width: 140px;
    }

    #bio-counter {
        font-weight: normal;
        transition: all 0.3s ease;
    }

    .counter-warning {
        color: #dc3545;
        font-weight: bold;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –ø–æ–ª—è "–û —Å–µ–±–µ"
        const bioField = document.getElementById('{{ profile_form.bio.id_for_label }}');
        const bioCounter = document.getElementById('bio-counter');

        if (bioField && bioCounter) {
            function updateCounter() {
                const remaining = 500 - bioField.value.length;
                bioCounter.textContent = `${remaining}`;

                if (remaining < 0) {
                    bioCounter.classList.add('counter-warning');
                    bioCounter.textContent = `-${Math.abs(remaining)}`;
                } else {
                    bioCounter.classList.remove('counter-warning');
                }
            }

            bioField.addEventListener('input', updateCounter);
            updateCounter(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
        const replaceAvatarBtn = document.querySelector('.replace-avatar-btn');
        const removeAvatarBtn = document.querySelector('.remove-avatar-btn');
        const avatarUploadField = document.querySelector('.avatar-upload-field');
        const avatarClearInput = document.getElementById('avatar-clear');
        const avatarPreview = document.getElementById('avatar-preview');
        const defaultAvatar = document.getElementById('default-avatar');
        const avatarButtons = document.getElementById('avatar-buttons');

        if (replaceAvatarBtn) {
            replaceAvatarBtn.addEventListener('click', function () {
                if (avatarUploadField) {
                    avatarUploadField.style.display = 'block';
                }
                if (avatarButtons) {
                    avatarButtons.style.display = 'none';
                }
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–º–µ–Ω–µ
                if (avatarClearInput) {
                    avatarClearInput.value = 'false';
                }
            });
        }

        if (removeAvatarBtn) {
            removeAvatarBtn.addEventListener('click', function () {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞
                if (avatarClearInput) {
                    avatarClearInput.value = 'true';
                }

                // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                if (avatarPreview) {
                    avatarPreview.style.display = 'none';
                }
                if (defaultAvatar) {
                    defaultAvatar.style.display = 'flex';
                }

                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
                if (avatarButtons) {
                    avatarButtons.style.display = 'none';
                }

                // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –æ—Ç–∫—Ä—ã—Ç–æ
                if (avatarUploadField) {
                    avatarUploadField.style.display = 'none';
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                const message = document.createElement('div');
                message.className = 'alert alert-info mt-2 small';
                message.textContent = '–ê–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è';
                this.closest('.existing-avatar').appendChild(message);
            });
        }

        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
        const avatarInput = document.querySelector('input[type="file"][name="avatar"]');
        if (avatarInput) {
            avatarInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
                    if (avatarClearInput) {
                        avatarClearInput.value = 'false';
                    }

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                    if (!validTypes.includes(file.type)) {
                        alert('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JPG, PNG, GIF –∏–ª–∏ WebP.');
                        this.value = '';
                        return;
                    }

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB.');
                        this.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (avatarPreview) {
                            avatarPreview.src = e.target.result;
                            avatarPreview.style.display = 'block';
                        }
                        if (defaultAvatar) {
                            defaultAvatar.style.display = 'none';
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤
        const citySearchInput = document.getElementById('{{ profile_form.city_search.id_for_label }}');
        const cityHiddenInput = document.getElementById('{{ profile_form.city.id_for_label }}');

        if (citySearchInput && cityHiddenInput) {
            // –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ datalist –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ
            citySearchInput.addEventListener('input', function () {
                const selectedCity = this.value;
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞ ID –≥–æ—Ä–æ–¥–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                // –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –ø—É—Å—Ç—ã–º, —Ç–∞–∫ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        const form = document.getElementById('profile-form');
        if (form) {
            form.addEventListener('submit', function (e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø–æ–ª–µ "–û —Å–µ–±–µ"
                if (bioField && bioField.value.length > 500) {
                    e.preventDefault();
                    alert('–ü–æ–ª–µ "–û —Å–µ–±–µ" –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 500 —Å–∏–º–≤–æ–ª–æ–≤. –°–µ–π—á–∞—Å: ' + bioField.value.length);
                    bioField.focus();
                    return false;
                }

                return true;
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ alert —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            setTimeout(() => {
                if (alert && alert.classList.contains('show')) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        });
    });
</script>
{% endblock %}