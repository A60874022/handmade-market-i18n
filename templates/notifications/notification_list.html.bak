{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Notifications" %} | HandmadeMarket{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="fw-bold mb-2">üîî {% trans "Notifications" %}</h1>
                    <p class="text-muted">{% trans "All notifications about your activity on the platform" %}</p>
                </div>
                <div>
                    {% if notifications and unread_notifications_count > 0 %}
                    <button type="button" class="btn btn-outline-primary me-2" id="markAllReadBtn">
                        üì™ {% trans "Mark All as Read" %}
                    </button>
                    {% endif %}

                    {% if notifications.exists %}
                    <button type="button" class="btn btn-outline-danger me-2" id="deleteAllReadBtn">
                        üóëÔ∏è {% trans "Delete Read" %}
                    </button>
                    {% endif %}

                    <a href="{% url 'orders:sale_orders' %}" class="btn btn-primary">
                        üí∞ {% trans "My Sales" %}
                    </a>
                </div>
            </div>

            {% if notifications %}
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    {% for notification in notifications %}
                    <div
                        class="notification-item p-4 {% if not notification.is_read %}bg-light border-start border-primary border-3 unread{% endif %} {% if not forloop.last %}border-bottom{% endif %}">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-start">
                                    <div class="me-3 mt-1">
                                        {% if not notification.is_read %}
                                        <span class="badge bg-primary">NEW</span>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1">{{ notification.title }}</h6>
                                        <p class="text-muted mb-2">{{ notification.message }}</p>
                                        <small class="text-muted">
                                            üìÖ {{ notification.created_at|date:"d.m.Y H:i" }}
                                            {% if notification.is_recent %}
                                            <span class="badge bg-success ms-2">{% trans "Today" %}</span>
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div
                                    class="d-flex flex-column flex-md-row justify-content-end gap-2 align-items-center">
                                    <span class="badge 
                                        {% if notification.notification_type == 'new_order' %}bg-success
                                        {% elif notification.notification_type == 'new_message' %}bg-info
                                        {% elif notification.notification_type == 'order_status_changed' %}bg-warning
                                        {% elif notification.notification_type == 'order_cancelled' %}bg-danger
                                        {% elif notification.notification_type == 'product_favorited' %}bg-pink
                                        {% else %}bg-secondary{% endif %} mb-2 mb-md-0">
                                        {{ notification.get_notification_type_display }}
                                    </span>

                                    {% if notification.action_url %}
                                    <a href="{{ notification.action_url }}" class="btn btn-outline-primary btn-sm">
                                        üìã {% trans "Go to" %}
                                    </a>
                                    {% endif %}

                                    {% if not notification.is_read %}
                                    <button class="btn btn-outline-success btn-sm mark-read-btn"
                                        data-notification-id="{{ notification.id }}" title="{% trans 'Mark as read' %}">
                                        ‚úÖ
                                    </button>
                                    {% else %}
                                    <span class="badge bg-secondary me-2">{% trans "Read" %}</span>
                                    <button class="btn btn-outline-danger btn-sm delete-single-btn"
                                        data-notification-id="{{ notification.id }}"
                                        title="{% trans 'Delete notification' %}">
                                        üóëÔ∏è
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            {% if is_paginated %}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">‚Üê {% trans "Back" %}</a>
                    </li>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans "Next" %} ‚Üí</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}

            {% else %}
            <div class="text-center py-5">
                <div class="mb-4" style="font-size: 4rem;">üîî</div>
                <h3 class="fw-bold mb-3">{% trans "No notifications yet" %}</h3>
                <p class="text-muted mb-4">{% trans "When new notifications about orders, messages or other activity
                    appear, they will be displayed here" %}</p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="{% url 'products:catalog' %}" class="btn btn-primary btn-lg px-4">
                        üõçÔ∏è {% trans "Go to Catalog" %}
                    </a>
                    <a href="{% url 'products:my_products' %}" class="btn btn-outline-primary btn-lg px-4">
                        üé® {% trans "My Products" %}
                    </a>
                    <a href="{% url 'products:product_add' %}" class="btn btn-outline-brown btn-lg px-4">
                        ‚ûï {% trans "Add Product" %}
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .text-brown {
        color: #8B4513;
    }

    .btn-primary {
        background-color: #8B4513;
        border-color: #8B4513;
        border-radius: 10px;
        font-weight: 600;
    }

    .btn-primary:hover {
        background-color: #654321;
        border-color: #654321;
    }

    .btn-outline-brown {
        color: #8B4513;
        border-color: #8B4513;
        border-radius: 10px;
        font-weight: 600;
    }

    .btn-outline-brown:hover {
        background-color: #8B4513;
        border-color: #8B4513;
        color: white;
    }

    .notification-item {
        transition: all 0.3s ease;
    }

    .notification-item:hover {
        background-color: #f8f9fa !important;
    }

    .notification-item.unread {
        background-color: #f0f8ff;
        border-left: 4px solid #8B4513 !important;
    }

    .mark-read-btn,
    .delete-single-btn {
        transition: all 0.3s ease;
        border-radius: 8px;
    }

    .mark-read-btn:hover {
        transform: scale(1.1);
        background-color: #198754;
        color: white;
    }

    .delete-single-btn:hover {
        transform: scale(1.1);
        background-color: #dc3545;
        color: white;
    }

    .bg-pink {
        background-color: #e83e8c !important;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è */
    .notification-item.fade-out {
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.3s ease;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
        .notification-item {
            padding: 1rem !important;
        }

        .d-flex.flex-column.flex-md-row {
            flex-direction: column !important;
            gap: 0.5rem !important;
        }

        .btn-sm {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }

        .badge.me-2 {
            margin-right: 0.5rem !important;
            margin-bottom: 0.5rem;
        }
    }
</style>

<script>
    // –û–±—ä–µ–∫—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è JavaScript
    const translations = {
        markAsRead: "{% trans 'Mark as read' %}",
        deleteNotification: "{% trans 'Delete notification' %}",
        markAllReadConfirm: "{% trans 'Mark all notifications as read?' %}",
        deleteReadConfirm: "{% trans 'Delete all read notifications? This action cannot be undone.' %}",
        deleteSingleConfirm: "{% trans 'Delete this notification?' %}",
        notificationMarkedRead: "{% trans 'Notification marked as read' %}",
        allNotificationsMarkedRead: "{% trans 'All notifications marked as read' %}",
        notificationDeleted: "{% trans 'Notification deleted' %}",
        readNotificationsDeleted: "{% trans 'Deleted {{ count }} read notifications' %}",
        errorMarkingRead: "{% trans 'Error marking notification as read' %}",
        errorMarkingAllRead: "{% trans 'Error marking all notifications as read' %}",
        errorDeleting: "{% trans 'Error deleting notification' %}",
        errorDeletingAll: "{% trans 'Error deleting notifications' %}",
        read: "{% trans 'Read' %}"
    };

    document.addEventListener('DOMContentLoaded', function () {
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
        function markAsRead(notificationId) {
            fetch(`/notifications/${notificationId}/mark-read/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`).closest('.notification-item');
                        notificationItem.classList.remove('bg-light', 'border-start', 'border-primary', 'border-3', 'unread');

                        // –£–±–∏—Ä–∞–µ–º –±–µ–π–¥–∂ NEW
                        const newBadge = notificationItem.querySelector('.badge.bg-primary');
                        if (newBadge) {
                            newBadge.remove();
                        }

                        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫
                        const buttonContainer = document.querySelector(`[data-notification-id="${notificationId}"]`).parentNode;

                        // –ó–∞–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—á–∏—Ç–∞—Ç—å" –Ω–∞ –±–µ–π–¥–∂ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" –∏ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å"
                        buttonContainer.innerHTML = `
                            <span class="badge bg-secondary me-2">${translations.read}</span>
                            <button class="btn btn-outline-danger btn-sm delete-single-btn"
                                data-notification-id="${notificationId}" title="${translations.deleteNotification}">
                                üóëÔ∏è
                            </button>
                        `;

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                        const newDeleteBtn = buttonContainer.querySelector('.delete-single-btn');
                        newDeleteBtn.addEventListener('click', function () {
                            const notifId = this.getAttribute('data-notification-id');
                            if (confirm(translations.deleteSingleConfirm)) {
                                deleteNotification(notifId);
                            }
                        });

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
                        updateUnreadCount();

                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ"
                        updateMarkAllReadButton();

                        showMessage(translations.notificationMarkedRead, 'success');
                    }
                })
                .catch(error => {
                    console.error('Error marking notification as read:', error);
                    showMessage(translations.errorMarkingRead, 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
        function markAllAsRead() {
            fetch('/notifications/mark-all-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        document.querySelectorAll('.notification-item').forEach(item => {
                            item.classList.remove('bg-light', 'border-start', 'border-primary', 'border-3', 'unread');

                            // –£–±–∏—Ä–∞–µ–º –±–µ–π–¥–∂–∏ NEW
                            const newBadge = item.querySelector('.badge.bg-primary');
                            if (newBadge) {
                                newBadge.remove();
                            }

                            // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫
                            const buttonContainer = item.querySelector('.d-flex.flex-column.flex-md-row');
                            const markReadBtn = buttonContainer.querySelector('.mark-read-btn');

                            if (markReadBtn) {
                                // –ó–∞–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—á–∏—Ç–∞—Ç—å" –Ω–∞ –±–µ–π–¥–∂ "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ" –∏ –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å"
                                const notificationId = markReadBtn.getAttribute('data-notification-id');
                                markReadBtn.outerHTML = `
                                    <span class="badge bg-secondary me-2">${translations.read}</span>
                                    <button class="btn btn-outline-danger btn-sm delete-single-btn"
                                        data-notification-id="${notificationId}" title="${translations.deleteNotification}">
                                        üóëÔ∏è
                                    </button>
                                `;

                                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                                const newDeleteBtn = buttonContainer.querySelector('.delete-single-btn');
                                newDeleteBtn.addEventListener('click', function () {
                                    const notifId = this.getAttribute('data-notification-id');
                                    if (confirm(translations.deleteSingleConfirm)) {
                                        deleteNotification(notifId);
                                    }
                                });
                            }
                        });

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
                        updateUnreadCount();

                        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ"
                        updateMarkAllReadButton();

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                        showMessage(translations.allNotificationsMarkedRead, 'success');
                    }
                })
                .catch(error => {
                    console.error('Error marking all notifications as read:', error);
                    showMessage(translations.errorMarkingAllRead, 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function deleteNotification(notificationId) {
            fetch(`/notifications/${notificationId}/delete/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –ê–Ω–∏–º–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ DOM
                        const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`).closest('.notification-item');
                        notificationItem.classList.add('fade-out');

                        setTimeout(() => {
                            notificationItem.remove();

                            // –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            if (document.querySelectorAll('.notification-item').length === 0) {
                                location.reload();
                            }
                        }, 300);

                        showMessage(translations.notificationDeleted, 'success');
                    } else {
                        showMessage(translations.errorDeleting, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error deleting notification:', error);
                    showMessage(translations.errorDeleting, 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function deleteAllReadNotifications() {
            fetch('/notifications/delete-all-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –ê–Ω–∏–º–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ DOM
                        const readNotifications = document.querySelectorAll('.notification-item:not(.unread)');
                        let deletedCount = 0;

                        readNotifications.forEach(item => {
                            item.classList.add('fade-out');
                            setTimeout(() => {
                                item.remove();
                                deletedCount++;

                                // –ï—Å–ª–∏ –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                                if (deletedCount === readNotifications.length && document.querySelectorAll('.notification-item').length === 0) {
                                    location.reload();
                                }
                            }, 300);
                        });

                        showMessage(translations.readNotificationsDeleted.replace('{{ count }}', data.deleted_count), 'success');
                    }
                })
                .catch(error => {
                    console.error('Error deleting all read notifications:', error);
                    showMessage(translations.errorDeletingAll, 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function updateUnreadCount() {
            fetch('/notifications/api/unread-count/')
                .then(response => response.json())
                .then(data => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    const unreadBadge = document.querySelector('.unread-badge');
                    if (unreadBadge) {
                        if (data.count > 0) {
                            unreadBadge.textContent = data.count;
                            unreadBadge.style.display = 'inline';
                        } else {
                            unreadBadge.style.display = 'none';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error updating unread count:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ"
        function updateMarkAllReadButton() {
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const unreadNotifications = document.querySelectorAll('.unread').length;

            if (unreadNotifications === 0 && markAllReadBtn) {
                markAllReadBtn.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(message, type = 'success') {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.querySelectorAll('.alert-dismissible').forEach(alert => {
                alert.remove();
            });

            const alertClass = type === 'error' ? 'alert-danger' : 'alert-success';
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show mt-3`;
            alertDiv.innerHTML = `
                ${type === 'success' ? '‚úÖ' : '‚ùå'} ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
            const notificationsContainer = document.querySelector('.card');
            if (notificationsContainer) {
                notificationsContainer.parentNode.insertBefore(alertDiv, notificationsContainer);
            }

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.querySelectorAll('.mark-read-btn').forEach(button => {
            button.addEventListener('click', function () {
                const notificationId = this.getAttribute('data-notification-id');
                markAsRead(notificationId);
            });
        });

        document.querySelectorAll('.delete-single-btn').forEach(button => {
            button.addEventListener('click', function () {
                const notificationId = this.getAttribute('data-notification-id');
                if (confirm(translations.deleteSingleConfirm)) {
                    deleteNotification(notificationId);
                }
            });
        });

        document.getElementById('markAllReadBtn')?.addEventListener('click', function () {
            if (confirm(translations.markAllReadConfirm)) {
                markAllAsRead();
            }
        });

        document.getElementById('deleteAllReadBtn')?.addEventListener('click', function () {
            if (confirm(translations.deleteReadConfirm)) {
                deleteAllReadNotifications();
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateUnreadCount, 30000);
    });
</script>
{% endblock %}